{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Office Setup</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/main_header.css' %}">
  <link rel="stylesheet" href="{% static 'css/business_office_setup.css' %}">
  <link rel="stylesheet" href="{% static 'css/business_steps.css' %}">
</head>

<body>
  <!-- Header -->
  {% include "home/includes/main_header.html" %}
  <br>
  <br>
  <br>
  <br>

  <section class="office-setup">
    <div class="steps">
      {% for i in range_total_steps %}
        <div class="step {% if step == i %}active{% endif %}">
          Step {{ i }}
        </div>
      {% endfor %}
    </div>

    <div class="title">
      <span class="icon" aria-hidden="true">&#127970;</span>
      <h2>Office Setup</h2>
    </div>

    <form method="POST" class="form-card" id="officeSetupForm">
      {% csrf_token %}

      <label>Office size</label>
      {{ form.office_size }}

      <label>Number of employees</label>
      {{ form.num_employees }}

      <label>Floors/levels</label>
      {{ form.floors }}

      <label>Number of restrooms</label>

      <input type="hidden" id="restrooms_input" name="restrooms"
             value="{{ form.instance.restrooms }}">

      <div class="restroom-options" id="restroomGroup">
        <div class="restroom-btn" data-val="1">1</div>
        <div class="restroom-btn" data-val="2">2</div>
        <div class="restroom-btn" data-val="3">3</div>
        <div class="restroom-btn" data-val="4+">4+</div>
      </div>

      <div class="kitchen-option">
        <img src="{% static 'images/frame-16865527071.png' %}" alt="Kitchen">

        <div class="text">
          <p class="title">Kitchen / pantry</p>
          <p class="subtitle">Does this area need cleaning</p>
        </div>

        <label class="switch">
          {{ form.kitchen_cleaning }}
          <span class="slider"></span>
        </label>
      </div>

      <div class="form-error" id="officeSetupError">Please fill in all required fields.</div>
      <div class="form-actions">
        <a onclick="window.history.back();" class="back-btn">
          <span class="back-icon">&larr;</span>
          Back
        </a>

        <button type="submit" class="next-btn">
          Next
          <span class="next-icon">&rarr;</span>
        </button>
      </div>
    </form>
  </section>

  {% include "home/includes/footer.html" %}

  <script>
    const restroomButtons = document.querySelectorAll(".restroom-btn");
    const restroomHidden = document.getElementById("restrooms_input");
    const restroomGroup = document.getElementById("restroomGroup");

    let saved = restroomHidden.value;

    restroomButtons.forEach((btn) => {
      if (btn.dataset.val === saved) {
        btn.classList.add("active");
      }
    });

    restroomButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        restroomButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        restroomHidden.value = btn.dataset.val;
        restroomGroup.classList.remove("field-error-pill");
      });
    });
  </script>
  <script>
    const officeForm = document.getElementById("officeSetupForm");
    const officeError = document.getElementById("officeSetupError");
    const officeFields = [
      document.getElementById("id_office_size"),
      document.getElementById("id_num_employees"),
      document.getElementById("id_floors"),
      document.getElementById("restrooms_input")
    ];

    const clearOfficeErrors = () => {
      officeFields.forEach((field) => field && field.classList.remove("field-error"));
      document.getElementById("restroomGroup").classList.remove("field-error-pill");
      officeError.classList.remove("is-visible");
    };

    officeFields.forEach((field) => {
      if (!field) return;
      field.addEventListener("input", clearOfficeErrors);
      field.addEventListener("change", clearOfficeErrors);
    });

    officeForm.addEventListener("submit", (e) => {
      clearOfficeErrors();
      let hasError = false;

      officeFields.forEach((field) => {
        if (!field) return;
        if (!field.value || !field.value.trim()) {
          field.classList.add("field-error");
          hasError = true;
        }
      });

      if (!document.getElementById("restrooms_input").value) {
        document.getElementById("restroomGroup").classList.add("field-error-pill");
        hasError = true;
      }

      if (hasError) {
        e.preventDefault();
        officeError.classList.add("is-visible");
      }
    });
  </script>

  <script src="{% static 'js/main_header.js' %}"></script>
</body>
</html>
