{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scheduling & Notes</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/main_header.css' %}">
  <link rel="stylesheet" href="{% static 'css/SchedulingNotes.css' %}">
  <link rel="stylesheet" href="{% static 'css/business_steps.css' %}">
</head>

<body>
  {% include "home/includes/main_header.html" %}

  <main class="container schedule-page">
    <div class="steps">
      {% for i in range_total_steps %}
        <div class="step {% if step == i %}active{% endif %}">
          Step {{ i }}
        </div>
      {% endfor %}
    </div>

    <form method="POST" id="scheduleForm">
      {% csrf_token %}

      <input type="hidden" name="start_date" id="start_date_input">
      <input type="hidden" name="preferred_time" id="preferred_time_input">
      <input type="hidden" name="days_type" id="days_type_input">
      <input type="hidden" name="custom_date" id="custom_date_input">
      <input type="hidden" name="custom_time" id="custom_time_input">
      <input type="hidden" name="notes" id="notes_input">

      <section class="card scheduling">
        <div class="card-title">
          <span class="title-icon" aria-hidden="true">&#128197;</span>
          <h2>Scheduling</h2>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="start-date">Desired start date</label>
            <input type="date" id="start-date" name="start_date_tmp">
          </div>

          <div class="form-group">
            <label for="preferred-time">Preferred time</label>
            <div class="custom-select" data-custom-select>
              <select id="preferred-time" name="preferred_time_tmp" data-native-select>
                <option value="">Select...</option>
                <option>Before office hours</option>
                <option>During office hours</option>
                <option>After office hours</option>
              </select>
              <button type="button" class="custom-select-toggle" data-select-toggle>
                <span data-select-label>Select...</span>
                <span class="custom-select-arrow"></span>
              </button>
              <div class="custom-select-menu" data-select-menu>
                <button type="button" class="custom-select-option" data-select-option="">Select...</button>
                <button type="button" class="custom-select-option" data-select-option="Before office hours">Before office hours</button>
                <button type="button" class="custom-select-option" data-select-option="During office hours">During office hours</button>
                <button type="button" class="custom-select-option" data-select-option="After office hours">After office hours</button>
              </div>
            </div>
          </div>
        </div>

        <div class="days">
          <label>Days of week</label>

          <div class="options">
            <label class="option-pill">
              <input type="radio" name="days" value="mon-fri">
              <span>Mon–Fri</span>
            </label>
            <label class="option-pill">
              <input type="radio" name="days" value="weekends">
              <span>Weekends</span>
            </label>
          </div>

          <div class="custom-wrapper">
            <div class="custom-field">
              <label class="option-pill">
                <input type="radio" name="days" value="custom-date">
                <span>Custom date</span>
              </label>
              <input type="date" id="custom-date" name="custom_date_tmp" disabled>
            </div>

            <div class="custom-field">
              <label class="option-pill">
                <input type="radio" name="days" value="custom-time">
                <span>Custom time</span>
              </label>
              <input type="time" id="custom-time" name="custom_time_tmp" disabled>
            </div>
          </div>
        </div>
      </section>

      <section class="card notes">
        <div class="card-title">
          <span class="title-icon" aria-hidden="true">&#128221;</span>
          <h2>Notes</h2>
        </div>

        <textarea id="notes" rows="6" placeholder="Write your notes here..."></textarea>

        <div class="buttons form-actions">
          <a onclick="window.history.back();" class="back-btn">
            <span class="back-icon">&larr;</span>
            Back
          </a>
          <button type="submit" class="next-btn">
            Done
            <span class="next-icon">&rarr;</span>
          </button>
        </div>
      </section>
    </form>
  </main>

  {% include "home/includes/footer.html" %}

  <script>
    document.querySelectorAll("input[name='days']").forEach((radio) => {
      radio.addEventListener("change", () => {
        const value = radio.value;
        document.getElementById("custom-date").disabled = value !== "custom-date";
        document.getElementById("custom-time").disabled = value !== "custom-time";
      });
    });

    document.getElementById("scheduleForm").addEventListener("submit", function () {
      document.getElementById("start_date_input").value =
        document.getElementById("start-date").value;

      document.getElementById("preferred_time_input").value =
        document.getElementById("preferred-time").value;

      const selectedDay = document.querySelector("input[name='days']:checked");
      document.getElementById("days_type_input").value =
        selectedDay ? selectedDay.value : "";

      document.getElementById("custom_date_input").value =
        document.getElementById("custom-date").value || "";

      document.getElementById("custom_time_input").value =
        document.getElementById("custom-time").value || "";

      document.getElementById("notes_input").value =
        document.getElementById("notes").value;
    });
  </script>

  <script>
    document.querySelectorAll("[data-custom-select]").forEach((selectWrap) => {
      const nativeSelect = selectWrap.querySelector("[data-native-select]");
      const toggle = selectWrap.querySelector("[data-select-toggle]");
      const label = selectWrap.querySelector("[data-select-label]");
      const menu = selectWrap.querySelector("[data-select-menu]");
      const options = selectWrap.querySelectorAll("[data-select-option]");

      const closeMenu = () => {
        selectWrap.classList.remove("open");
      };

      toggle.addEventListener("click", (e) => {
        e.stopPropagation();
        selectWrap.classList.toggle("open");
      });

      options.forEach((option) => {
        option.addEventListener("click", () => {
          const value = option.getAttribute("data-select-option");
          nativeSelect.value = value;
          label.textContent = option.textContent.trim();
          closeMenu();
        });
      });

      document.addEventListener("click", () => {
        closeMenu();
      });
    });
  </script>

  <script src="{% static 'js/main_header.js' %}"></script>
</body>
</html>
