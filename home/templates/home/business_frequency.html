{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frequency</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/main_header.css' %}">
  <link rel="stylesheet" href="{% static 'css/business_frequency.css' %}">
  <link rel="stylesheet" href="{% static 'css/business_steps.css' %}">
</head>

<body>
  {% include "home/includes/main_header.html" %}

  <div class="steps">
    {% for i in range_total_steps %}
      <div class="step {% if step == i %}active{% endif %}">
        Step {{ i }}
      </div>
    {% endfor %}
  </div>

  <div class="frequency-page">
    <div class="title-wrap">
      <span class="title-icon" aria-hidden="true">&#128467;</span>
      <h2 class="title">Frequency</h2>
    </div>

    <form method="POST" class="frequency-card">
      {% csrf_token %}
      <input type="hidden" name="frequency_data" id="frequencyInput">

      <p class="question">How often do you need cleaning</p>

      <div class="options">
        <button type="button" class="freq-card" data-type="daily">
          <img src="{% static 'images/calendar-unified.svg' %}" alt="Daily">
          <span>Daily</span>
        </button>

        <button type="button" class="freq-card" data-type="times">
          <img src="{% static 'images/calendar-unified.svg' %}" alt="Times per week">
          <div class="card-content">
            <select class="times-select" id="timesSelect" aria-label="Times per week">
              <option>1</option>
              <option>2</option>
              <option selected>3</option>
              <option>4</option>
              <option>5</option>
            </select>
            <span>times per week</span>
          </div>
        </button>

        <button type="button" class="freq-card" data-type="weekly">
          <img src="{% static 'images/calendar-unified.svg' %}" alt="Weekly">
          <span>Weekly</span>
        </button>

        <button type="button" class="freq-card" data-type="monthly">
          <img src="{% static 'images/calendar-unified.svg' %}" alt="Monthly">
          <span>Monthly</span>
        </button>

        <button type="button" class="freq-card" data-type="ondemand">
          <img src="{% static 'images/calendar-unified.svg' %}" alt="On-demand">
          <span>On-demand</span>
        </button>

        <button type="button" class="freq-card" data-type="yearly">
          <img src="{% static 'images/calendar-unified.svg' %}" alt="Yearly">
          <span>Yearly</span>
        </button>
      </div>

      <div class="form-error" id="frequencyError">Please select a frequency option.</div>
      <div class="buttons form-actions">
        <a onclick="window.history.back();" class="back-btn">
          <span class="back-icon">&larr;</span>
          Back
        </a>
        <button type="submit" class="next-btn">
          Next
          <span class="next-icon">&rarr;</span>
        </button>
      </div>
    </form>
  </div>

  <br>
  <br>
  <br>
  <br>

  {% include "home/includes/footer.html" %}

  <script>
    const cards = document.querySelectorAll('.freq-card');
    let selected = null;

    const frequencyError = document.getElementById("frequencyError");
    cards.forEach(card => {
      card.addEventListener('click', () => {
        cards.forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');

        const type = card.dataset.type;

        if (type === "times") {
          const times = document.getElementById("timesSelect").value;
          selected = { type: "times_per_week", value: times };
        } else {
          selected = { type: type };
        }

        document.getElementById("frequencyInput").value = JSON.stringify(selected);
        frequencyError.classList.remove("is-visible");
      });
    });

    document.getElementById("timesSelect").addEventListener("change", () => {
      let card = document.querySelector('.freq-card[data-type="times"]');
      if (card.classList.contains("selected")) {
        selected = { type: "times_per_week", value: document.getElementById("timesSelect").value };
        document.getElementById("frequencyInput").value = JSON.stringify(selected);
        frequencyError.classList.remove("is-visible");
      }
    });
  </script>
  <script>
    const frequencyForm = document.querySelector("form");
    frequencyForm.addEventListener("submit", (e) => {
      if (!document.getElementById("frequencyInput").value) {
        e.preventDefault();
        frequencyError.classList.add("is-visible");
      }
    });
  </script>

  <script src="{% static 'js/main_header.js' %}"></script>
</body>
</html>
