{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Profile | Hembla</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/main_header.css' %}">
  <link rel="stylesheet" href="{% static 'css/provider_portal.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  
</head>

<body class="provider-portal">
{% include "home/includes/main_header.html" %}

<div class="provider-wrap">

  {% if messages %}
    {% for m in messages %}
      <div class="msg">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <section class="hero-card">
    <div class="avatar">
      {% if request.user.provider_profile.photo %}
        <img src="{{ request.user.provider_profile.photo.url }}" alt="Provider photo">
      {% else %}
        {{ request.user.first_name|slice:":1"|upper }}{{ request.user.last_name|slice:":1"|upper }}
      {% endif %}
    </div>
    <div>
      <div class="hero-title">{{ request.user.get_full_name|default:request.user.username }}</div>
      <div class="hero-sub">Provider Profile</div>
      <div class="meta hero-meta">
        <span><i class="fa-solid fa-envelope"></i> {{ request.user.email|default:"â€”" }}</span>
        <span><i class="fa-solid fa-id-badge"></i> Provider ID: {{ request.user.id }}</span>
      </div>
      <div class="hero-actions">
        <a class="pill primary" href="{% url 'accounts:provider_bookings' %}">
          <i class="fa-solid fa-briefcase"></i> My Orders
        </a>
        <a class="pill" href="{% url 'accounts:provider_inbox' %}">
          <i class="fa-solid fa-comments"></i> Messages
        </a>
      </div>
    </div>
  </section>

  <section class="summary-grid">
    <div class="summary-card">
      <div class="summary-label">Active Orders</div>
      <div class="summary-value">{{ active_orders }}</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Completed</div>
      <div class="summary-value">{{ completed_orders }}</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Admin Messages</div>
      <div class="summary-value">{{ unread_admin }}</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Provider ID</div>
      <div class="summary-value">#{{ request.user.id }}</div>
    </div>
  </section>

  <section class="grid-2">
    <div class="provider-card">
      <div class="section-title provider-title">Personal Information</div>
      <form method="post">
        {% csrf_token %}

        <div class="field">
          <label>First name</label>
          {{ form.first_name }}
        </div>

        <div class="field">
          <label>Last name</label>
          {{ form.last_name }}
        </div>

        <div class="field">
          <label>Email</label>
          {{ form.email }}
        </div>

        <button class="btn">Save Changes</button>
        <a href="{% url 'accounts:provider_change_password' %}" class="link-soft">
          Change Password
        </a>
      </form>
    </div>

    <div class="provider-card">
      <div class="section-title provider-title">Quick Actions</div>
      <div class="list">
        <div class="list-item">
          <div>
            <b>My Orders</b>
            <small>View and manage assigned jobs</small>
          </div>
          <a class="pill" href="{% url 'accounts:provider_bookings' %}">Open</a>
        </div>
        <div class="list-item">
          <div>
            <b>Messages</b>
            <small>Chat with customers</small>
          </div>
          <a class="pill" href="{% url 'accounts:provider_inbox' %}">Open</a>
        </div>
        <div class="list-item">
          <div>
            <b>Security</b>
            <small>Update password</small>
          </div>
          <a class="pill" href="{% url 'accounts:provider_change_password' %}">Open</a>
        </div>
      </div>
    </div>
  </section>

  <section class="provider-card" style="margin-top:18px;">
    <div class="section-title provider-title">Admin Messages</div>
    {% if recent_admin_messages %}
      <div class="list">
        {% for msg in recent_admin_messages %}
          <div class="list-item">
            <div class="meta">
              <div class="thread-title">{{ msg.title }}</div>
              <div class="thread-sub">{{ msg.created_at|date:"M d, Y h:i A" }}</div>
              {% if msg.body %}
                <div class="muted" style="margin-top:6px;">{{ msg.body }}</div>
              {% endif %}
            </div>
            {% if not msg.is_read %}
              <span class="badge warn">New</span>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="muted">No admin messages yet.</div>
    {% endif %}
  </section>
</div>
<script src="{% static 'js/main_header.js' %}"></script>

</body>
</html>
