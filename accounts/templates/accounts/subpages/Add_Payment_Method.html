{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/Add_Payment_Method.css' %}" />
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/customer_sidebar.css' %}">
<link rel="stylesheet" href="{% static 'css/main_header.css' %}">
  

  <title>Add Payment Method</title>
  
</head>
<body>
  <!-- HEADER -->
{% include "home/includes/main_header.html" %}
  <!-- Overlay -->
  <div class="layout">

 
      <!-- Sidebar -->
     <!-- زر المينيو يظهر فقط بالموبايل -->
<div class="mobile-header">
  <button class="menu-toggle floating customer-menu-toggle" id="menuToggle">
    <span class="arrow">&#8250;</span> <!-- › -->
  </button>
  <h2 class="mobile-title">Customer Profile</h2>
</div>



  <!-- ===== Sidebar ===== -->
        {% include "accounts/includes/customer_sidebar.html" %}

    <!-- Main -->
<main class="main">
  <section class="card">
    <h2>Add Payment Method</h2>

    <form method="post">
      {% csrf_token %}
      {% if form.errors %}
        <div class="form-errors">
          {% for field in form %}
            {% for error in field.errors %}
              <div class="error">{{ error }}</div>
            {% endfor %}
          {% endfor %}
          {% for error in form.non_field_errors %}
            <div class="error">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Cardholder -->
      <div class="form-group">
        <label>Cardholder Name</label>
        <div class="input-wrap icon-user">
          {{ form.cardholder_name }}
        </div>
      </div>

      <!-- Card Number -->
      <div class="form-group">
        <label>Card Number</label>
        <div class="input-wrap icon-card">
          <input
            type="text"
            id="cardNumber"
            name="card_number"
            placeholder="1234 5678 9012 3456"
            maxlength="19"
            inputmode="numeric"
            required
          >
        </div>
      </div>

      <!-- Expiry + CVV -->
      <div class="form-row">
        <div class="form-group">
          <label>Expiration Date</label>
          <div class="input-wrap icon-calendar">
            <input
              type="text"
              id="expiryDate"
              name="expiry_date"
              placeholder="MM/YY"
              maxlength="5"
              inputmode="numeric"
              required
            >
          </div>
        </div>

        <div class="form-group">
          <label>CVV</label>
          <div class="input-wrap icon-lock">
            <input
              type="text"
              id="cvv"
              name="cvv"
              placeholder="CVV"
              maxlength="4"
              inputmode="numeric"
              required
            >
          </div>
        </div>
      </div>

      <!-- Card Type -->
      <input type="hidden" name="card_type" id="cardType" required>

      <div class="form-group">
        <label>Card Type</label>
        <div class="pills">
          <button type="button" class="pill" data-type="visa">
            <img src="{% static 'images/visa.png' %}" alt="Visa">
            <span>Visa</span>
          </button>
          <button type="button" class="pill" data-type="mastercard">
            <img src="{% static 'images/mastercard.png' %}" alt="MasterCard">
            <span>MasterCard</span>
          </button>
          <button type="button" class="pill" data-type="amex">
            <img src="{% static 'images/amex.svg' %}" alt="American Express">
            <span>American Express</span>
          </button>
          <button type="button" class="pill" data-type="discover">
            <img src="{% static 'images/discover.png' %}" alt="Discover">
            <span>Discover</span>
          </button>
        </div>
      </div>

      <!-- Default -->
      <div class="inline-check">
        {{ form.is_default }}
        <label for="{{ form.is_default.id_for_label }}">
          Set as default payment method
        </label>
      </div>

      <button type="submit" class="btn">Save Payment Method</button>

    </form>
  </section>
</main>
</div>

<!-- ================= JS ================= -->

<script>
// ===== Card Number formatting + detect type =====
const cardInput = document.getElementById("cardNumber");
const cardTypeInput = document.getElementById("cardType");
const pills = document.querySelectorAll(".pill");

function resetPills() {
  pills.forEach(p => p.classList.remove("active"));
}

cardInput.addEventListener("input", function () {
  let value = this.value.replace(/\D/g, "");
  this.value = value.replace(/(.{4})/g, "$1 ").trim();

  resetPills();

  if (value.startsWith("4")) {
    selectType("visa");
  } else if (value.startsWith("5")) {
    selectType("mastercard");
  } else if (value.startsWith("34") || value.startsWith("37")) {
    selectType("amex");
  } else if (value.startsWith("6")) {
    selectType("discover");
  } else {
    cardTypeInput.value = "";
  }
});

function selectType(type) {
  cardTypeInput.value = type;
  document.querySelector(`.pill[data-type="${type}"]`)?.classList.add("active");
}

// ===== Expiry auto slash =====
const expiryInput = document.getElementById("expiryDate");
expiryInput.addEventListener("input", function () {
  let v = this.value.replace(/\D/g, "");
  if (v.length >= 3) v = v.slice(0,2) + "/" + v.slice(2,4);
  this.value = v;
});

// ===== CVV numeric only =====
document.getElementById("cvv").addEventListener("input", function () {
  this.value = this.value.replace(/\D/g, "");
});

// ===== Manual pill click =====
pills.forEach(pill => {
  pill.addEventListener("click", () => {
    resetPills();
    pill.classList.add("active");
    cardTypeInput.value = pill.dataset.type;
  });
});
</script>

<script>
(function () {
  const toggle = document.getElementById("menuToggle");
  const sidebar = document.querySelector(".sidebar");
  const overlay = document.querySelector(".customer-menu-overlay");
  if (!toggle || !sidebar) return;
  toggle.addEventListener("click", () => {
    const open = sidebar.classList.toggle("open");
    if (overlay) overlay.classList.toggle("show", open);
  });
  if (overlay) {
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    });
  }
})();
</script>
<script src="{% static 'js/main_header.js' %}"></script>
</body>
</html>



