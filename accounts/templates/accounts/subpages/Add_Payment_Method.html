{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/Add_Payment_Method.css' %}" />
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  

  <title>Document</title>
  <style>
    .pill.active {
  background-color: #00a6cf; /* نفس لون الزر */
  color: #fff;
  font-weight: 600;
}

  </style>
</head>
<body>
  <!-- HEADER -->
<header class="main-header">
  <div class="logo">
    <img src="{% static 'images/logo.png' %}" alt="Logo">
  </div>

  <div class="menu-toggle" id="menu-toggle">☰</div>

  <nav class="nav-links" id="nav-links">
    <a href="{% url 'home:home' %}">HOME</a>
    <a href="{% url 'home:about' %}">ABOUT</a>
    <a href="#">SERVICES</a>
    <a href="#">PRICING</a>
    <a href="#">CONTACT</a>
  </nav>

  <div class="profile-btn">
    <a href="#">My Profile</a>
  </div>
</header>
  <!-- Overlay -->
  <div class="layout">

 
      <!-- Sidebar -->
     <!-- زر المينيو يظهر فقط بالموبايل -->
<div class="mobile-header">
  <button class="menu-toggle floating" id="menuToggle">
    <span class="arrow">&#8250;</span> <!-- › -->
  </button>
  <h2 class="mobile-title">Customer Profile</h2>
</div>



  <!-- ===== Sidebar ===== -->
        <aside class="sidebar">
      <div class="profile-head">
        <div class="avatar"></div>
        <div>
          <div class="name">Sophia Bennett</div>
          <div class="id">ID: 123456</div>
        </div>
      </div>

      <form id="logout-form" method="post" action="{% url 'logout' %}" style="display: none;">
          {% csrf_token %}
      </form>

      <nav class="side-nav">
        <a href="{% url 'accounts:customer_profile_view' %}" class="nav-item active"><img src="{% static 'images/user-location0.png' %}" class="ico"><span>Overview</span></a>
        <a href="{% url 'accounts:Address_and_Locations_view' %}" class="nav-item"><img src="{% static 'images/user-location1.png' %}" class="ico"><span>Address & Locations</span></a>
        <a href="{% url 'accounts:my_bookimg' %}" class="nav-item"><img src="{% static 'images/event-accepted0.png'%}" class="ico"><span>My Bookings</span></a>
        <a href="{% url 'accounts:incident' %}" class="nav-item"><img src="{% static 'images/user-location1.png'%}" class="ico"><span>Incidents</span></a>
        <a href="{% url 'accounts:Service_Preferences' %}" class="nav-item"><img src="{% static 'images/settings0.png'%}" class="ico"><span>Service Preferences</span></a>
        <a href="{% url 'accounts:Communication' %}" class="nav-item" ><img src="{% static 'images/communication0.png'%}" class="ico"><span>Communication</span></a>
        <a href="{% url 'accounts:Customer_Notes' %}" class="nav-item" ><img src="{% static 'images/list-view0.png'%}" class="ico"><span>Customer Notes</span></a>
        <a href="{% url 'accounts:Payment_and_Billing' %}" class="nav-item"><img src="{% static 'images/magnetic-card0.png'%}" class="ico"><span>Payment & Billing</span></a>
        <a href="{% url 'accounts:Change_Password' %}" class="nav-item"><img src="{% static 'images/person1.png'%}" class="ico"><span>Change Password</span></a>
        <a href="{% url 'accounts:Service_History_and_Ratings' %}" class="nav-item"><img src="{% static 'images/vector2.svg'%}" class="ico"><span>Service History & Ratings</span></a>
        <a href="{% url 'accounts:Loyalty_and_Rewards' %}" class="nav-item"><img src="{% static 'images/prize0.png'%}" class="ico"><span>Loyalty & Rewards</span></a>
        <a href="#" class="nav-item" onclick="event.preventDefault(); document.getElementById('logout-form').submit();"><img src="{% static 'images/logout-rounded0.png' %}" class="ico"><span>Logout</span></a>
      </nav>
    </aside>
    <!-- Main -->
<main class="main">
  <section class="card">
    <h2>Add Payment Method</h2>

    <form method="post">
      {% csrf_token %}

      <!-- Cardholder -->
      <div class="form-group">
        <label>Cardholder Name</label>
        {{ form.cardholder_name }}
      </div>

      <!-- Card Number -->
      <div class="form-group">
        <label>Card Number</label>
        <input
          type="text"
          id="cardNumber"
          name="card_number"
          placeholder="1234 5678 9012 3456"
          maxlength="19"
          inputmode="numeric"
          required
        >
      </div>

      <!-- Expiry + CVV -->
      <div class="form-row">
        <div class="form-group">
          <label>Expiration Date</label>
          <input
            type="text"
            id="expiryDate"
            name="expiry_date"
            placeholder="MM/YY"
            maxlength="5"
            inputmode="numeric"
            required
          >
        </div>

        <div class="form-group">
          <label>CVV</label>
          <input
            type="text"
            id="cvv"
            name="cvv"
            placeholder="CVV"
            maxlength="4"
            inputmode="numeric"
            required
          >
        </div>
      </div>

      <!-- Card Type -->
      <input type="hidden" name="card_type" id="cardType" required>

      <div class="form-group">
        <label>Card Type</label>
        <div class="pills">
          <button type="button" class="pill" data-type="visa">Visa</button>
          <button type="button" class="pill" data-type="mastercard">MasterCard</button>
          <button type="button" class="pill" data-type="amex">American Express</button>
          <button type="button" class="pill" data-type="discover">Discover</button>
        </div>
      </div>

      <!-- Default -->
      <div class="inline-check">
        {{ form.is_default }}
        <label for="{{ form.is_default.id_for_label }}">
          Set as default payment method
        </label>
      </div>

      <button type="submit" class="btn">Save Payment Method</button>

    </form>
  </section>
</main>
</div>

<!-- ================= JS ================= -->

<script>
// ===== Card Number formatting + detect type =====
const cardInput = document.getElementById("cardNumber");
const cardTypeInput = document.getElementById("cardType");
const pills = document.querySelectorAll(".pill");

function resetPills() {
  pills.forEach(p => p.classList.remove("active"));
}

cardInput.addEventListener("input", function () {
  let value = this.value.replace(/\D/g, "");
  this.value = value.replace(/(.{4})/g, "$1 ").trim();

  resetPills();

  if (value.startsWith("4")) {
    selectType("visa");
  } else if (value.startsWith("5")) {
    selectType("mastercard");
  } else if (value.startsWith("34") || value.startsWith("37")) {
    selectType("amex");
  } else if (value.startsWith("6")) {
    selectType("discover");
  } else {
    cardTypeInput.value = "";
  }
});

function selectType(type) {
  cardTypeInput.value = type;
  document.querySelector(`.pill[data-type="${type}"]`)?.classList.add("active");
}

// ===== Expiry auto slash =====
const expiryInput = document.getElementById("expiryDate");
expiryInput.addEventListener("input", function () {
  let v = this.value.replace(/\D/g, "");
  if (v.length >= 3) v = v.slice(0,2) + "/" + v.slice(2,4);
  this.value = v;
});

// ===== CVV numeric only =====
document.getElementById("cvv").addEventListener("input", function () {
  this.value = this.value.replace(/\D/g, "");
});

// ===== Manual pill click =====
pills.forEach(pill => {
  pill.addEventListener("click", () => {
    resetPills();
    pill.classList.add("active");
    cardTypeInput.value = pill.dataset.type;
  });
});
</script>

</body>
</html>



