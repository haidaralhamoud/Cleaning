{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loyalty & Rewards</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Vesper+Libre:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/Loyalty_and_Rewards.css' %}" />
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <style>
    .tier.active{
  outline: 3px solid #0ea5e9;
  transform: translateY(-2px);
}
.tier {
  border-radius: 14px;
  padding: 18px;
  text-align: center;
  border: 2px solid transparent;
  transition: all .25s ease;
}

/* ===== BRONZE ===== */
.tier.bronze {
  background: #FFF4E6;
  border-color: #E6A15A;
  color: #8A4B12;
}

/* ===== SILVER ===== */
.tier.silver {
  background: #F5F6F8;
  border-color: #C7CBD1;
  color: #4B5563;
}

/* ===== GOLD ===== */
.tier.gold {
  background: #FFF9DB;
  border-color: #F0C75E;
  color: #8B6B00;
}

/* ===== ACTIVE ===== */
.tier.active {
  box-shadow: 0 0 0 3px rgba(0,0,0,.08);
  transform: scale(1.03);
}
.tier.active::after {
  content: "âœ“ Your level";
  display: block;
  margin-top: 8px;
  font-size: 12px;
  font-weight: 700;
}

/* ===== PROMOTION CARD ===== */
.promo {
  position: relative;
  background: linear-gradient(135deg, #ffffff, #f3fbff);
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 12px 30px rgba(0, 160, 200, 0.18);
  border: 2px solid #00b4d8;
  overflow: hidden;
  animation: promoGlow 2.5s infinite ease-in-out;
}

/* subtle glow animation */
@keyframes promoGlow {
  0% { box-shadow: 0 0 0 rgba(0,180,216,0.4); }
  50% { box-shadow: 0 0 25px rgba(0,180,216,0.55); }
  100% { box-shadow: 0 0 0 rgba(0,180,216,0.4); }
}

/* ===== BADGE ===== */
.promo::before {
  content: "ðŸ”¥ Limited Offer";
  position: absolute;
  top: 14px;
  left: -40px;
  background: linear-gradient(135deg, #ff9800, #ff5722);
  color: #fff;
  padding: 6px 45px;
  font-size: 13px;
  font-weight: 700;
  transform: rotate(-45deg);
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}

/* ===== IMAGE ===== */
.promo img {
  width: 100%;
  border-radius: 14px;
  margin-bottom: 14px;
}

/* ===== TITLE ===== */
.promo h5 {
  font-size: 20px;
  font-weight: 800;
  margin: 10px 0 6px;
}

/* ===== DESCRIPTION ===== */
.promo p {
  color: #555;
  font-size: 14px;
  margin-bottom: 14px;
}

/* ===== CTA BUTTON ===== */
.promo .btn {
  width: 100%;
  background: linear-gradient(135deg, #00b4d8, #0077b6);
  color: #fff;
  font-weight: 800;
  border-radius: 14px;
  padding: 14px;
  font-size: 16px;
  border: none;
  transition: all 0.25s ease;
}

.promo .btn:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 10px 25px rgba(0, 180, 216, 0.5);
}

  </style>
</head>
<body>
<!-- HEADER -->
<header class="main-header">
  <div class="logo">
    <img src="{% static 'images/logo.png' %}" alt="Logo">
  </div>

  <div class="menu-toggle" id="menu-toggle">â˜°</div>

  <nav class="nav-links" id="nav-links">
    <a href="{% url 'home:home' %}">HOME</a>
    <a href="{% url 'home:about' %}">ABOUT</a>
    <a href="#">SERVICES</a>
    <a href="#">PRICING</a>
    <a href="#">CONTACT</a>
  </nav>

  <div class="profile-btn">
    <a href="#">My Profile</a>
  </div>
</header>
  <div class="layout">

    <!-- ===== Mobile Header ===== -->
    <div class="mobile-header">
      <button class="menu-toggle floating" id="menuToggle">
        <span class="arrow">&#8250;</span>
      </button>
      <h2 class="mobile-title">Customer Profile</h2>
    </div>

    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <div class="profile-head">
        <div class="avatar"></div>
        <div>
          <div class="name">
            {{ request.user.get_full_name|default:request.user.username }}
          </div>
          <div class="id">ID: {{ request.user.id }}</div>
        </div>
      </div>

      <form id="logout-form" method="post" action="{% url 'logout' %}" style="display: none;">
          {% csrf_token %}
      </form>

      <nav class="side-nav">
        <a href="{% url 'accounts:customer_profile_view' %}" class="nav-item active"><img src="{% static 'images/user-location0.png' %}" class="ico"><span>Overview</span></a>
        <a href="{% url 'accounts:Address_and_Locations_view' %}" class="nav-item"><img src="{% static 'images/user-location1.png' %}" class="ico"><span>Address & Locations</span></a>
        <a href="{% url 'accounts:my_bookimg' %}" class="nav-item"><img src="{% static 'images/event-accepted0.png'%}" class="ico"><span>My Bookings</span></a>
        <a href="{% url 'accounts:incident' %}" class="nav-item"><img src="{% static 'images/user-location1.png'%}" class="ico"><span>Incidents</span></a>
        <a href="{% url 'accounts:Service_Preferences' %}" class="nav-item"><img src="{% static 'images/settings0.png'%}" class="ico"><span>Service Preferences</span></a>
        <a href="{% url 'accounts:Communication' %}" class="nav-item" ><img src="{% static 'images/communication0.png'%}" class="ico"><span>Communication</span></a>
        <a href="{% url 'accounts:Customer_Notes' %}" class="nav-item" ><img src="{% static 'images/list-view0.png'%}" class="ico"><span>Customer Notes</span></a>
        <a href="{% url 'accounts:Payment_and_Billing' %}" class="nav-item"><img src="{% static 'images/magnetic-card0.png'%}" class="ico"><span>Payment & Billing</span></a>
        <a href="{% url 'accounts:Change_Password' %}" class="nav-item"><img src="{% static 'images/person1.png'%}" class="ico"><span>Change Password</span></a>
        <a href="{% url 'accounts:Service_History_and_Ratings' %}" class="nav-item"><img src="{% static 'images/vector2.svg'%}" class="ico"><span>Service History & Ratings</span></a>
        <a href="{% url 'accounts:Loyalty_and_Rewards' %}" class="nav-item"><img src="{% static 'images/prize0.png'%}" class="ico"><span>Loyalty & Rewards</span></a>
        <a href="#" class="nav-item" onclick="event.preventDefault(); document.getElementById('logout-form').submit();"><img src="{% static 'images/logout-rounded0.png' %}" class="ico"><span>Logout</span></a>
      </nav>
    </aside>

    <!-- ===== Main Content ===== -->
    <main class="main">
      <h1 class="page-title fade-in">Loyalty &amp; Rewards</h1>

      <section class="card fade-in" style="animation-delay:.05s">
        <div class="banner-sky"></div>

<!-- Points Balance -->
<div class="points-box">
  <div class="points-text">
    <small>Points Balance</small>
    <strong>{{ points_balance }}</strong>

    {% if next_tier_name %}
      <span>You're only {{ next_tier_points }} pts away from {{ next_tier_name }} Tier ðŸŽ‰</span>
    {% else %}
      <span>You're at the highest tier ðŸŽ‰</span>
    {% endif %}
  </div>

  <div class="tier-pill">
{% if current_tier %}
  <div class="tier-pill">
    <b>{{ current_tier.name }} Member</b>
  </div>
{% endif %}
  </div>
</div>

        <!-- Tiers -->
        <h3 class="section-title">Tiers &amp; Status</h3>
        <div class="tiers">
          {% for tier in tiers %}
            <div class="tier {{ tier.color }} {% if current_tier and tier.id == current_tier.id %}active{% endif %}">
              <h4>{{ tier.name }}</h4>

              {% if tier.max_points %}
                <p>({{ tier.min_points }}â€“{{ tier.max_points }} pts)</p>
              {% else %}
                <p>(+ {{ tier.min_points }} pts)</p>
              {% endif %}

              <p>{{ tier.benefits }}</p>
            </div>
          {% endfor %}
        </div>



        <!-- Milestones -->
            <h3 class="section-title">Milestone Tracker</h3>
            <div class="milestones">

              <!-- Book 5 cleanings -->
              <div class="milestone">
                <div class="row">
                  <b>Book {{ book_5_target }} cleanings</b>
                  <small>{{ book_5_done }}/{{ book_5_target }}</small>
                </div>
                <div class="progress">
                  <span class="fill" data-pct="{{ book_5_percent }}"></span>
                </div>

                {% if book_5_done < book_5_target %}
                  <div class="hint">
                    Book {{ book_5_target|add:"-"|add:book_5_done }} more to unlock a Free Add-on!
                  </div>
                {% else %}
                  <div class="hint success">ðŸŽ‰ Milestone completed!</div>
                {% endif %}
              </div>

              <!-- Refer 3 friends -->
              <div class="milestone">
                <div class="row">
                  <b>Refer {{ refer_target }} friends</b>
                  <small>{{ refer_done }}/{{ refer_target }}</small>
                </div>
                <div class="progress">
                  <span class="fill" data-pct="{{ refer_percent }}"></span>
                </div>

                {% if refer_done < refer_target %}
                  <div class="hint">
                    Invite {{ refer_target|add:"-"|add:refer_done }} more friends to unlock a Free Service!
                  </div>
                {% else %}
                  <div class="hint success">ðŸŽ‰ Referral reward unlocked!</div>
                {% endif %}
              </div>

            </div>


        <!-- Rewards -->
        <h3 class="section-title">Available Rewards</h3>
        <div class="rewards">
          {% for r in rewards %}
            <div class="reward {% if not r.can_redeem %}locked{% endif %}">
              <div class="sub"
                  style="{% if r.can_redeem %}color:var(--sky-strong){% endif %}">
                {{ r.points_required }} points
              </div>

              <h5>{{ r.title }}</h5>
              <div class="desc">{{ r.description }}</div>

              {% if r.can_redeem %}
                <form method="post" action="{% url 'accounts:redeem_reward' r.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn">
                      Redeem Now
                    </button>
                  </form>
              {% else %}
                <button class="btn lock" disabled>
                  <img src="{% static 'images/lock0.png' %}" alt="">
                  Earn {{ r.missing_points }} more points
                </button>
              {% endif %}
            </div>
          {% endfor %}

        </div>

        <!-- Refer -->
        <div class="refer">
          <b>Refer a Friend &amp; Earn Big!</b>
          <div style="color:var(--sky-strong); font-weight:700; margin-top:4px;">
            Earn <span style="font-weight:900; font-size:18px;">500 pts</span> â€” your friend gets 10% off their first booking.
          </div>
          <div class="share-row">
            <a class="share wa" href="#"><img src="{% static 'images/whats-app0.png' %}" alt="">WhatsApp</a>
            <a class="share fb" href="#"><img src="{% static 'images/facebook1.png' %}" alt="">Facebook</a>
            <a class="share lk" href="#"><img src="{% static 'images/link0.png' %}" alt="">Copy Link</a>
          </div>
        </div>

        <!-- Activity -->
        <div class="grid-2">
          <div class="activity">
            <h3 class="section-title" style="margin-top:0">Available Rewards</h3>

            {% for t in transactions %}
              <div class="item">
                <div><b>{{ t.reason|default:"Points Update" }}</b></div>
                <small>{{ t.created_at|date:"F d, Y" }}</small>
                <div class="pts {% if t.amount > 0 %}green{% else %}red{% endif %}">
                  {% if t.amount > 0 %}+{% endif %}{{ t.amount }} pts
                </div>
              </div>
            {% empty %}
              <div class="item">
                <div><b>No Activity Yet</b></div>
                <small>â€”</small>
                <div class="pts">0 pts</div>
              </div>
            {% endfor %}
          </div>

            {% if promotion %}
        <div class="promo">
          <h3 class="section-title" style="margin-top:0">Promotions</h3>

          <img src="{{ promotion.image.url }}" alt="promotion">

          <h5>{{ promotion.title }}</h5>
          <p>{{ promotion.description }}</p>

          <button class="btn">
            ðŸš€ Book Now & Earn x{{ promotion.points_multiplier }} Points
          </button>
        </div>

            {% endif %}

        </div>
      </section>
    </main>
  </div>

<footer class="footer">
  <div class="footer-container">
    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ 1: Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙˆØ§Ù„Ù†Øµ -->
    <div class="footer-col about">
      <img src="{% static 'images/logo.png' %}" alt="Hembla Logo" class="footer-logo">
      <p>
        At Hembla, we believe home should be your haven, not your to-do list. 
        From cleaning to care, weâ€™re here to make life easier, one home at a time.
      </p>

      <!-- Ø§Ù„ØµÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ ØªØ­Øª Ø§Ù„Ù†Øµ -->
      <div class="bottom-left">
        <!-- Connect -->
        <div class="connect">
          <h4>Connect</h4>
          <div class="socials">
            <img src="{% static 'images/facebook0.png'%}" alt="facebook">
            <img src="{% static 'images/instagram-circle0.png'%}" alt="instagram">
            <img src="{% static 'images/linked-in-circled0.png'%}" alt="linkedin">
            <img src="{% static 'images/whats-app0.png'%}" alt="whatsapp">
          </div>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ 2: Support -->
    <div class="footer-col support">
      <h4>Support</h4>
      <ul>
        <li><a href="#">Contact Us</a></li>
        <li><a href="#">Address</a></li>
        <li><a href="#">Working Hours</a></li>
        <li><a href="#">FAQ</a></li>
      </ul>
              <!-- App Download -->
        <div class="app-download">
          <h4>App Download</h4>
          <div class="apps">
            <img src="{% static 'images/mobile0.png'%}" alt="mobile">
            <img src="{% static 'images/chat-gpt-image-sep-15-2025-05-50-28-pm-10.png'%}" alt="app store">
          </div>
        </div>
    </div>

    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ 3: Company -->
    <div class="footer-col company">
      <h4>Company</h4>
      <ul>
        <li><a href="#">About Us</a></li>
        <li><a href="#">Careers</a></li>
        <li><a href="#">Our Story</a></li>
        <li><a href="#">Feedback</a></li>
      </ul>
    </div>

    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ 4: Legal / Privacy -->
    <div class="footer-col legal">
      <h4>Legal/Privacy</h4>
      <ul>
        <li><a href="#">Privacy Policy</a></li>
        <li><a href="#">Terms & Conditions</a></li>
        <li><a href="#">Cookie Policy</a></li>
        <li><a href="#">Accessibility Statement</a></li>
      </ul>
    </div>
  </div>

  <!-- Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„ -->
  <hr class="footer-line">

  <!-- Ø§Ù„ØµÙ Ø§Ù„Ø³ÙÙ„ÙŠ -->
  <div class="footer-bottom">
    <div class="language-box">
      <img src="{% static 'images/earth-globe0.png'%}" alt="earth" class="earth-icon">
      <span>Language</span>
    </div>
    <p>Â© 2025 Hembla Cleaning Services. All rights reserved.</p>
  </div>
</footer>

<script>
const toggleBtn = document.getElementById("menu-toggle");
const navLinks = document.getElementById("nav-links");
  
toggleBtn.addEventListener("click", () => {
  navLinks.classList.toggle("active");
});
</script>
  <script>
    window.addEventListener('load', ()=>{
      document.querySelectorAll('.progress .fill').forEach(el=>{
        const pct = +el.getAttribute('data-pct') || 0;
        requestAnimationFrame(()=> el.style.width = pct + '%');
      });
    });

    const toggle = document.getElementById("menuToggle");
    const sidebar = document.querySelector(".sidebar");
    const arrow = document.querySelector(".menu-toggle .arrow");

    toggle.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      arrow.innerHTML = sidebar.classList.contains("open") ? "&#8249;" : "&#8250;";
    });
  </script>

</body>
</html>
