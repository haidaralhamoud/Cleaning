{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Change Password - Customer Profile</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2family=Inter:wght@400;600;700&family=Vesper+Libre:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/Change_Password.css' %}">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/customer_sidebar.css' %}">
<link rel="stylesheet" href="{% static 'css/main_header.css' %}">
  
</head>

<body>

<!-- HEADER -->
{% include "home/includes/main_header.html" %}
  <!-- ===== Mobile Header ===== -->
  <div class="mobile-header">
    <button class="menu-toggle floating customer-menu-toggle" id="menuToggle">
      <span class="arrow">&#8250;</span>
    </button>
    
  </div>

<div class="layout">


    <!-- ===== Sidebar ===== -->
    {% include "accounts/includes/customer_sidebar.html" %}
  <!-- نفس السايدبار تبعك بدون تعديل -->


<main class="main">
  <h1>Change Password</h1>
  <h3 class="subtitle">Last Password Update March 5, 2024</h3>

  <div class="card">

    <form method="post">
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="form-error-box">
          {% for err in form.non_field_errors %}
            <div>{{ err }}</div>
          {% endfor %}
        </div>
      {% endif %}
      <!-- Current Password -->
<label class="field-label">Current Password</label>
<div class="input-group">
  <input
    type="password"
    name="{{ form.old_password.name }}"
    placeholder="Enter current password"
    class="{% if form.old_password.errors %}input-error{% endif %}"
    required
  >
  <i class="fa-regular fa-eye icon"></i>
</div>

{% if form.old_password.errors %}
  <div class="field-error">{{ form.old_password.errors.0 }}</div>
{% endif %}


      <!-- New Password -->
<label class="field-label">New Password</label>
<div class="input-group">
  <input
    id="newPassword"
    type="password"
    name="{{ form.new_password1.name }}"
    placeholder="Enter new password"
    class="{% if form.new_password1.errors %}input-error{% endif %}"
    required
  >
  <i class="fa-regular fa-eye icon"></i>
</div>

{% if form.new_password1.errors %}
  <div class="field-error">{{ form.new_password1.errors.0 }}</div>
{% endif %}


      <!-- Strength Bar -->
      <div class="strength">
        <div class="labels">
          <span>Weak</span>
          <span>Medium</span>
          <span>Strong</span>
        </div>
        <div class="bar">
          <div id="strengthBar"></div>
        </div>
      </div>

      <p class="note">
        Must be at least 8 characters, include uppercase, lowercase, number, and special character.
      </p>

      <!-- Confirm Password -->
<label class="field-label">Confirm New Password</label>
<div class="input-group">
  <input
    type="password"
    name="{{ form.new_password2.name }}"
    placeholder="Re-enter new password"
    class="{% if form.new_password2.errors %}input-error{% endif %}"
    required
  >
  <i class="fa-regular fa-eye icon"></i>
</div>

{% if form.new_password2.errors %}
  <div class="field-error">{{ form.new_password2.errors.0 }}</div>
{% endif %}


      <p class="info">
        <i class="fa-solid fa-circle-info"></i>
        You'll be logged out from all devices once you change your password.
      </p>

      <div class="actions">
        <button type="submit" class="btn save">Save Changes</button>
        <a href="{% url 'accounts:customer_profile_view' %}" class="btn cancel">Cancel</a>
      </div>

    </form>
  </div>
</main>

</div>
{% include "home/includes/footer.html" %}
<!-- ===== JS تبعك كما هو ===== -->
 <script>
  const closeBtn = document.getElementById("closeBtn");
  const popup = document.getElementById("popup");

  if (closeBtn) {
    closeBtn.addEventListener("click", () => {
      popup.style.opacity = "0";
      popup.style.transform = "scale(0.9)";
      setTimeout(() => {
        popup.parentElement.style.display = "none";
      }, 300);
    });
  }
</script>

<script>
const passwordInput = document.querySelector('input[name="new_password1"]');
const strengthBar = document.getElementById("strengthBar");

if (passwordInput) {
  passwordInput.addEventListener("input", () => {
    const value = passwordInput.value;
    let strength = 0;

    if (/[a-z]/.test(value)) strength++;
    if (/[A-Z]/.test(value)) strength++;
    if (/[0-9]/.test(value)) strength++;
    if (/[^a-zA-Z0-9]/.test(value)) strength++;
    if (value.length >= 8) strength++;

    strengthBar.style.width = `${(strength / 5) * 100}%`;

    if (strength <= 2) strengthBar.style.background = "#e21010";
    else if (strength <= 4) strengthBar.style.background = "#ffe313";
    else strengthBar.style.background = "#64ff00";
  });
}

// show / hide password
document.querySelectorAll(".input-group .icon").forEach(icon => {
  icon.addEventListener("click", () => {
    const input = icon.previousElementSibling;
    input.type = input.type === "password"  "text" : "password";
    icon.classList.toggle("fa-eye");
    icon.classList.toggle("fa-eye-slash");
  });
});
</script>
{% if show_popup %}
  <div class="popup-overlay">
    <div class="frame-1686552582" id="popup">
      <img class="close-window" src="{% static 'images/close-window0.png' %}" alt="Close" id="closeBtn">
      <img class="check-mark" src="{% static 'images/check-mark0.png' %}" alt="Success">
      <div class="your-password-has-been-updated-successfully">
        Your password has been updated successfully
      </div>
    </div>
  </div>
{% endif %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const closeBtn = document.getElementById("closeBtn");
  const popup = document.getElementById("popup");

  if (closeBtn && popup) {
    closeBtn.addEventListener("click", function () {
      popup.style.opacity = "0";
      popup.style.transform = "scale(0.9)";

      setTimeout(() => {
        popup.closest(".popup-overlay").style.display = "none";
      }, 300);
    });
  }
});
</script>


<script>
(function () {
  const toggle = document.getElementById("menuToggle");
  const sidebar = document.querySelector(".sidebar");
  const overlay = document.querySelector(".customer-menu-overlay");
  if (!toggle || !sidebar) return;
  toggle.addEventListener("click", () => {
    const open = sidebar.classList.toggle("open");
    if (overlay) overlay.classList.toggle("show", open);
  });
  if (overlay) {
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    });
  }
})();
</script>
<script src="{% static 'js/main_header.js' %}"></script>
</body>
</html>
