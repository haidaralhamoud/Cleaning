{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Bookings - Hembla</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Vesper+Libre:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/my_bookimg.css' %}" />
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/customer_sidebar.css' %}">
<link rel="stylesheet" href="{% static 'css/main_header.css' %}">
</head>
<body>
<!-- HEADER -->
{% include "home/includes/main_header.html" %}

  <div class="page">

    <!-- ===== Mobile Header ===== -->
    <div class="mobile-header">
<!-- Floating Menu Button -->
<button class="menu-toggle customer-menu-toggle" id="menuToggle">
  <span class="arrow">&#8250;</span>
</button>

 
    </div>

    <!-- ===== Sidebar ===== -->
    {% include "accounts/includes/customer_sidebar.html" %}


    <!-- ===== Main Content ===== -->
    <main class="main">
      <h1 class="page-title">My Bookings</h1>
      <p class="subtitle">Your bookings, your history, your peace of mind</p>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-target="all">All</button>
        <button class="tab" data-target="upcoming">Upcoming</button>
        <button class="tab" data-target="ongoing">Ongoing</button>
        <button class="tab" data-target="completed">Completed</button>
        <button class="tab" data-target="cancelled">Cancelled</button>
      </div>

      <!-- Tables -->
      <div class="tables">
        <!-- All -->
        <div class="table-container active" id="all">
          <table>
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer Name</th>
                <th>Service Type</th>
                <th>Date</th>
                <th>Location</th>
                <th>Status</th>
                <th>View</th>
              </tr>
            </thead>
<tbody>
{% for b in bookings %}
<tr data-status="{{ b.status|lower }}">
  <td data-label="Order ID">#{{ b.id }}</td>
  <td data-label="Customer Name">{{ b.customer_name }}</td>
 <td data-label="Service Type">
<a class="service-link" href="{% url 'accounts:view_service_details' b.type|lower b.id %}">
    {{ b.service }}
  </a>
  <br>
  <small style="opacity:.6;">({{ b.type }})</small>
</td>
  <td data-label="Date">{{ b.date|date:"F d, Y" }}</td>
  <td data-label="Location">{{ b.location }}</td>
  <td data-label="Status">
    <span class="status status-{{ b.status|lower }}">
  {% if b.status == "upcoming" %}
    Scheduled
  {% else %}
    {{ b.status|title }}
  {% endif %}
</span>

  </td>
<td data-label="View">
  <div class="menu-wrap">
    <button class="dots">•••</button>

    <div class="dropdown">

  {# فقط إذا الحجز مو مكتمل ولا ملغي #}
  {% if b.status not in "completed cancelled" %}
    <a href="#" class="action-reschedule">Reschedule</a>
    <a href="#" class="action-cancel">Cancel</a>
  {% endif %}

  <a href="#" class="action-invoice">Download invoice</a>
  <a href="#" class="action-add">Add service</a>

</div>

  </div>
</td>

</tr>
{% empty %}
<tr>
  <td colspan="7" style="text-align:center;">
    No bookings yet
  </td>
</tr>
{% endfor %}
<tr id="no-results" style="display:none;">
  <td colspan="7" style="text-align:center; padding:20px; opacity:.6;">
    No bookings found
  </td>
</tr>
</tbody>

          </table>
        </div>
      </div>
    </main>
  </div>

  <div class="overlay customer-menu-overlay" id="overlay"></div>
{% include "home/includes/footer.html" %}



<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll(".tab");
  const rows = document.querySelectorAll("tbody tr[data-status]");
  const noResults = document.getElementById("no-results");

  function filterRows(target) {
    let visibleCount = 0;

    rows.forEach(row => {
      const status = row.dataset.status;

      if (target === "all" || status === target) {
        row.style.display = "";
        visibleCount++;
      } else {
        row.style.display = "none";
      }
    });

    // إذا ما في ولا صف ظاهر
    if (visibleCount === 0) {
      noResults.style.display = "";
    } else {
      noResults.style.display = "none";
    }
  }

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      const target = tab.dataset.target;

      tabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");

      filterRows(target);
    });
  });

  // تشغيل افتراضي على All
  filterRows("all");
});

document.querySelectorAll(".dots").forEach(btn => {
  btn.addEventListener("click", e => {
    e.stopPropagation();
    document.querySelectorAll(".menu-wrap").forEach(m => m.classList.remove("show"));
    btn.closest(".menu-wrap").classList.toggle("show");
  });
});

document.addEventListener("click", () => {
  document.querySelectorAll(".menu-wrap").forEach(m => m.classList.remove("show"));
});

</script>

 
<script>
(function () {
  const toggle = document.getElementById("menuToggle");
  const sidebar = document.querySelector(".sidebar");
  const overlay = document.querySelector(".customer-menu-overlay");
  if (!toggle || !sidebar) return;
  toggle.addEventListener("click", () => {
    const open = sidebar.classList.toggle("open");
    if (overlay) overlay.classList.toggle("show", open);
  });
  if (overlay) {
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    });
  }
})();
</script>
<script src="{% static 'js/main_header.js' %}"></script>
</body>
</html>
