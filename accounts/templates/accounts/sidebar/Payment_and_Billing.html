{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Payment & Billing — Customer Profile</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Vesper+Libre:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/Payment_and_Billing.css' %}" />
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>
<style>
   
</style>
<body>
<!-- HEADER -->
<header class="main-header">
  <div class="logo">
    <img src="{% static 'images/logo.png' %}" alt="Logo">
  </div>

  <div class="menu-toggle" id="menu-toggle">☰</div>

  <nav class="nav-links" id="nav-links">
    <a href="{% url 'home:home' %}">HOME</a>
    <a href="{% url 'home:about' %}">ABOUT</a>
    <a href="#">SERVICES</a>
    <a href="#">PRICING</a>
    <a href="#">CONTACT</a>
  </nav>

  <div class="profile-btn">
    <a href="#">My Profile</a>
  </div>
</header>

<div class="layout">
  <!-- Mobile header -->
  <div class="mobile-header">
    <button class="menu-toggle floating" id="menuToggle">
      <span class="arrow">&#8250;</span>
    </button>
    <h2 class="mobile-title">Customer Profile</h2>
  </div>

  <!-- ===== Sidebar ===== -->
        <aside class="sidebar">
      <div class="profile-head">
        <div class="avatar"></div>
        <div>
          <div class="name">Sophia Bennett</div>
          <div class="id">ID: 123456</div>
        </div>
      </div>

      <form id="logout-form" method="post" action="{% url 'logout' %}" style="display: none;">
          {% csrf_token %}
      </form>

      <nav class="side-nav">
        <a href="{% url 'accounts:customer_profile_view' %}" class="nav-item active"><img src="{% static 'images/user-location0.png' %}" class="ico"><span>Overview</span></a>
        <a href="{% url 'accounts:Address_and_Locations_view' %}" class="nav-item"><img src="{% static 'images/user-location1.png' %}" class="ico"><span>Address & Locations</span></a>
        <a href="{% url 'accounts:my_bookimg' %}" class="nav-item"><img src="{% static 'images/event-accepted0.png'%}" class="ico"><span>My Bookings</span></a>
        <a href="{% url 'accounts:incident' %}" class="nav-item"><img src="{% static 'images/user-location1.png'%}" class="ico"><span>Incidents</span></a>
        <a href="{% url 'accounts:Service_Preferences' %}" class="nav-item"><img src="{% static 'images/settings0.png'%}" class="ico"><span>Service Preferences</span></a>
        <a href="{% url 'accounts:Communication' %}" class="nav-item" ><img src="{% static 'images/communication0.png'%}" class="ico"><span>Communication</span></a>
        <a href="{% url 'accounts:Customer_Notes' %}" class="nav-item" ><img src="{% static 'images/list-view0.png'%}" class="ico"><span>Customer Notes</span></a>
        <a href="{% url 'accounts:Payment_and_Billing' %}" class="nav-item"><img src="{% static 'images/magnetic-card0.png'%}" class="ico"><span>Payment & Billing</span></a>
        <a href="{% url 'accounts:Change_Password' %}" class="nav-item"><img src="{% static 'images/person1.png'%}" class="ico"><span>Change Password</span></a>
        <a href="{% url 'accounts:Service_History_and_Ratings' %}" class="nav-item"><img src="{% static 'images/vector2.svg'%}" class="ico"><span>Service History & Ratings</span></a>
        <a href="{% url 'accounts:Loyalty_and_Rewards' %}" class="nav-item"><img src="{% static 'images/prize0.png'%}" class="ico"><span>Loyalty & Rewards</span></a>
        <a href="#" class="nav-item" onclick="event.preventDefault(); document.getElementById('logout-form').submit();"><img src="{% static 'images/logout-rounded0.png' %}" class="ico"><span>Logout</span></a>
      </nav>
    </aside>

  <!-- MAIN -->
  <main class="main">
    <h1>Payment & Billing</h1>

    <div class="page-grid">

      <!-- ✅ Payment methods (Django) -->
      <section class="card payment-methods-card">
        <div class="card-header">
          <h2>Payment Methods</h2>
          <a href="{% url 'accounts:Add_Payment_Method' %}">
            <button class="btn-icon">＋</button>
          </a>
        </div>

        <div class="payments-list">
          {% if payment_methods %}
            {% for pm in payment_methods %}
              <div class="payment-row">
                <div class="payment-left">

                  {% if pm.card_type == "visa" %}
                    <img src="{% static 'images/visa.png' %}" class="pm-icon">
                  {% elif pm.card_type == "mastercard" %}
                    <img src="{% static 'images/mastercard.png' %}" class="pm-icon">
                  {% elif pm.card_type == "amex" %}
                    <img src="{% static 'images/amex.png' %}" class="pm-icon">
                  {% elif pm.card_type == "discover" %}
                    <img src="{% static 'images/discover.png' %}" class="pm-icon">
                  {% endif %}

                  <div class="pm-text">
                    <div class="pm-title">
                      <strong>{{ pm.get_card_type_display }} •••• {{ pm.card_last4 }}</strong>
                    </div>
                    <div class="pm-sub">Expires {{ pm.expiry_date }}</div>
                  </div>
                </div>

                <div class="payment-right">
                  {% if pm.is_default %}
                    <span class="btn-default state">Default</span>
                  {% else %}
                    <a href="{% url 'accounts:set_payment_default' pm.id %}" class="btn-default">
                      Set as default
                    </a>
                  {% endif %}

                  <a href="{% url 'accounts:delete_payment_method' pm.id %}"
                     class="icon-edit"
                     onclick="return confirm('Delete this payment method?')">
                    ✕
                  </a>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p class="muted">No payment methods added yet.</p>
          {% endif %}
        </div>
      </section>

      <!-- ❌ Subscription (تركناه كما هو) -->
      <aside class="card subscription-card">
        <h3>Subscription</h3>
        <div id="subscriptionContent"></div>
      </aside>

    </div>

    <!-- ❌ Invoice History (تركناه كما هو) -->
    <section class="card invoice-history">
      <h2>Invoice History</h2>
      <table id="invoiceTable">
        <thead>
          <tr>
            <th>Invoice #</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Payment Method</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

  </main>
</div>

<footer class="footer">
  <div class="footer-bottom">
    <p>© 2025 Hembla Cleaning Services. All rights reserved.</p>
  </div>
</footer>

<!-- JS (تركناه متل ما هو) -->
<script>
const toggleBtn = document.getElementById("menu-toggle");
const navLinks = document.getElementById("nav-links");

if (toggleBtn) {
  toggleBtn.addEventListener("click", () => {
    navLinks.classList.toggle("active");
  });
}

const toggle = document.getElementById("menuToggle");
const sidebar = document.querySelector(".sidebar");
const arrow = document.querySelector(".menu-toggle .arrow");

if (toggle) {
  toggle.addEventListener("click", () => {
    sidebar.classList.toggle("open");
    arrow.innerHTML = sidebar.classList.contains("open") ? "&#8249;" : "&#8250;";
  });
}
</script>
<script>
/* ====== Subscription (mock data) ====== */
const subscription = {
  title: "Weekly Cleaning - 2 hrs $150/session",
  nextCharge: "July 20, 2025 ($150)",
  nextService: "July 22, 2025"
};

const subscriptionEl = document.getElementById("subscriptionContent");
if (subscriptionEl) {
  subscriptionEl.innerHTML = `
    <p><strong>${subscription.title}</strong></p>
    <p>Next charge: ${subscription.nextCharge}</p>
    <p>Next service: ${subscription.nextService}</p>
    <div class="sub-actions">
      <button class="btn-outline">Manage</button>
      <button class="btn-outline">Cancel</button>
    </div>
  `;
}

/* ====== Invoice History (mock data) ====== */
const invoices = [
  { id: "#12345", date: "July 1, 2025", amount: "$150.00", method: "{% static 'images/klarna.png' %}", status: "Paid" },
  { id: "#12346", date: "July 10, 2025", amount: "$150.00", method: "{% static 'images/paypal.png' %}", status: "Paid" },
  { id: "#12347", date: "July 20, 2025", amount: "$150.00", method: "{% static 'images/swish.png' %}", status: "Paid" }
];

const invoiceTable = document.querySelector("#invoiceTable tbody");
if (invoiceTable) {
  invoiceTable.innerHTML = "";
  invoices.forEach(inv => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${inv.id}</td>
      <td>${inv.date}</td>
      <td>${inv.amount}</td>
      <td><img src="${inv.method}" class="method-icon"></td>
      <td><span class="status paid">${inv.status}</span></td>
      <td><a href="#">Download</a></td>
    `;
    invoiceTable.appendChild(tr);
  });
}
</script>

</body>
</html>
